#!/bin/sh

set -e

SITE_BUILD="$1"

echo "Installing Rust..."
echo

if ! rustup show >/dev/null 2>&1; then
  echo "• Installing Rustup..."
  curl "https://sh.rustup.rs" -sSf | sh -s -- -y
fi

echo "• Installing current toolchain..."
rustup toolchain install "$(cat rust-toolchain)"

# if ! cobalt --version | grep -q "0.15.4"; then
  echo "• Installing Cobalt..."
  cargo install --force cobalt-bin --features pagination-unstable --version "0.15.4"
# fi
echo
echo "Building Site..."
echo
cobalt build -d "$SITE_BUILD"
